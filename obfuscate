-- Obfuscator.Client.lua (Fixed for Executor)
local RunService = game:GetService("RunService")

local ClientObfuscator = {}

function ClientObfuscator.ProtectAndRun(codeString)
    local cleanCode = codeString:gsub("%-%-%[%[", "COMMENT_OPEN"):gsub("%]%]", "COMMENT_CLOSE")
    
    local encodedParts = {}
    for i = 1, #cleanCode do
        local char = cleanCode:sub(i, i)
        local byte = string.byte(char)
        local encodedByte = byte ~ ((i * 11 + 5) % 256)
        table.insert(encodedParts, tostring(encodedByte))
    end
    
    -- Build loader code
    local loaderCode = 
    "local parts = {" .. table.concat(encodedParts, ",") .. "}\n" ..
    "local result = ''\n" ..
    "for i = 1, #parts do\n" ..
    "   local key = (i * 11 + 5) % 256\n" ..
    "   result = result .. string.char(parts[i] ~ key)\n" ..
    "end\n" ..
    "result = result:gsub('COMMENT_OPEN', '--[['):gsub('COMMENT_CLOSE', ']]')\n" ..
    "local func = loadstring(result)\n" ..
    "if func then return func() else return 'Load Error' end"

    if not RunService:IsClient() then
        return "Client only"
    end
    
    -- Use loadstring directly
    local func = loadstring(loaderCode)
    if func then
        return func()
    else
        return "Compile Error"
    end
end

return ClientObfuscator
